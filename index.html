<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>台北南區勤前照片上傳系統</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    input[type="file"] {
      font-size: 18px;
      /* 放大文字 */
      padding: 10px 14px;
      /* 放大按鈕內距 */
      border: 2px solid #333;
      /* 加粗邊框 */
      border-radius: 6px;
      /* 圓角邊框 */
      background-color: #f9f9f9;
      cursor: pointer;
    }

    body {
      font-family: "微軟正黑體", sans-serif;
      font-size: 16px;
      line-height: 1.6;
      padding: 20px;
      background-color: #f9f9f9;
    }

    h2 {
      font-size: 36px;
      margin-bottom: 10px;
      color: #333;
    }

    h3 {
      font-size: 22px;
      margin-bottom: 10px;
      color: #333;
    }

    label,
    .note-label {
      font-size: 16px;
      color: #444;
    }

    select,
    input[type="date"],
    input[type="month"] {
      font-size: 16px;
      padding: 6px;
      margin-bottom: 10px;
    }

    .upload-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      background-color: #fff;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 15px;
      gap: 10px;
    }

    .preview {
      width: 120px;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .preview-img {
      width: 150px;
      height: auto;
      margin: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .preview-img.zoom {
      transform: scale(3);
      z-index: 999;
      position: relative;
    }

    button {
      font-size: 16px;
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }
  </style>
</head>

<body>
  <!-- LOGO -->
  <div style="text-align: center; margin-bottom: 20px;">
    <img src="/uploads/company-logo.png" alt="公司LOGO" style="height: 80px;">
  </div>
  <!-- 原本的標題 -->
  <h2>台北南區勤前照片</h2>
  <h3>請先選擇所屬大樓別</h3>
  <select name="building" id="building">
    <option value="" disabled selected hidden>請選擇</option>
    <option value="松山金融">松山金融</option>
    <option value="前瞻金融">前瞻金融</option>
    <option value="全球民權">全球民權</option>
    <option value="產物大樓">產物大樓</option>
    <option value="芷英大樓">芷英大樓</option>
    <option value="華航大樓">華航大樓</option>
    <option value="南京科技">南京科技</option>
    <option value="互助營造">互助營造</option>
    <option value="摩天大樓">摩天大樓</option>
    <option value="新莊農會">新莊農會</option>
    <option value="儒鴻企業">儒鴻企業</option>
    <option value="新板傑仕堡">新板傑仕堡</option>
    <option value="新板金融">新板金融</option>
    <option value="桃園金融">桃園金融</option>
    <option value="新竹大樓">新竹大樓</option>
    <option value="竹科大樓">竹科大樓</option>
    <option value="頭份大樓">頭份大樓</option>
  </select>
  <br><br>

  <!-- 四組上傳欄位 -->
  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview1')">
    <img id="preview1" class="preview" src="">
    <span class="note-label">備註：勤前照片</span>
    <button onclick="uploadImage(this, 'preview1')">點擊上傳</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview2')">
    <img id="preview2" class="preview" src="">
    <span class="note-label">備註：勤前照片</span>
    <button onclick="uploadImage(this, 'preview2')">點擊上傳</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview3')">
    <img id="preview3" class="preview" src="">
    <span class="note-label">備註：勤前照片</span>
    <button onclick="uploadImage(this, 'preview3')">點擊上傳</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview4')">
    <img id="preview4" class="preview" src="">
    <span class="note-label">備註：勤前指示單</span>
    <button onclick="uploadImage(this, 'preview4')">點擊上傳</button>
  </div>

  <h3>勤前照片上傳預覽</h3>
  <label for="date">選擇日期：</label>
  <input type="date" id="date" oninput="filterByDate()">

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const images = document.querySelectorAll(".preview-img");
      images.forEach(img => {
        img.addEventListener("click", () => {
          img.classList.toggle("zoom");
        });
      });
    });
    function filterByDate() {
      const date = document.getElementById('date').value;
      window.location.href = '/gallery?date=' + date;
    }
  </script>

  <h3>勤前照片上傳統計查詢</h3>
  <label for="month">選擇月份：</label>
  <input type="month" id="month" onchange="filterByMonth()">

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('previewDate').value = today;
      loadGallery();
    });

    function uploadImage(button, previewId) {
      const row = button.parentElement;
      const fileInput = row.querySelector('input[type="file"]');
      const noteLabel = row.querySelector('.note-label');
      const building = document.getElementById('building').value;
      const file = fileInput.files[0];
      const note = noteLabel.textContent.replace('備註：', '').trim();

      if (!file || !building) {
        alert('請選擇所屬大樓別');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);
      formData.append('building', building);
      formData.append('note', note);

      fetch('/upload-image', {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          alert(data.message || '圖片上傳成功');

          // ✅ 更新圖片預覽為伺服器上的圖片（可選）
          const preview = document.getElementById(previewId);
          if (preview && data.filename) {
            preview.src = encodeURI('/uploads/' + data.filename);
            preview.style.display = 'inline-block'; // 如果你想顯示伺服器圖片
          }

          // ✅ 記住檔名（存在 row 的 data-filename 屬性）
          row.setAttribute('data-filename', data.filename);

          // ✅ 清空檔案欄位
          fileInput.value = '';

          // ✅ 清空預覽圖片（讓使用者知道已完成）
          if (preview) {
            // 若你不想顯示伺服器圖片，而是直接清空預覽：
            preview.removeAttribute('src');
            preview.style.display = 'none';
          }
        })

    }

    // ✅ 跳轉統計查詢
    function filterByMonth() {
      const month = document.getElementById('month').value;
      window.location.href = '/stats?month=' + month;
    }
  </script>

  <script>
    function previewImage(input, previewId) {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById(previewId);
        preview.src = e.target.result;
        preview.style.display = 'block'; // 顯示圖片（如果你有用 CSS 隱藏）
      };
      reader.readAsDataURL(file);
    }
  </script>

</body>

</html>

