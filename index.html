<!DOCTYPE html>
<html lang="zh-Hant">

<head>
  <meta charset="UTF-8">
  <title>å°åŒ—å—å€å‹¤å‰ç…§ç‰‡ä¸Šå‚³ç³»çµ±</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    input[type="file"] {
      font-size: 18px;
      /* æ”¾å¤§æ–‡å­— */
      padding: 10px 14px;
      /* æ”¾å¤§æŒ‰éˆ•å…§è· */
      border: 2px solid #333;
      /* åŠ ç²—é‚Šæ¡† */
      border-radius: 6px;
      /* åœ“è§’é‚Šæ¡† */
      background-color: #f9f9f9;
      cursor: pointer;
    }

    body {
      font-family: "å¾®è»Ÿæ­£é»‘é«”", sans-serif;
      font-size: 16px;
      line-height: 1.6;
      padding: 20px;
      background-color: #f9f9f9;
    }

    h2 {
      font-size: 36px;
      margin-bottom: 10px;
      color: #333;
    }

    h3 {
      font-size: 22px;
      margin-bottom: 10px;
      color: #333;
    }

    label,
    .note-label {
      font-size: 16px;
      color: #444;
    }

    select,
    input[type="date"],
    input[type="month"] {
      font-size: 16px;
      padding: 6px;
      margin-bottom: 10px;
    }

    .upload-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      background-color: #fff;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      margin-bottom: 15px;
      gap: 10px;
    }

    .preview {
      width: 120px;
      height: auto;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .preview-img {
      width: 150px;
      height: auto;
      margin: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .preview-img.zoom {
      transform: scale(3);
      z-index: 999;
      position: relative;
    }

    button {
      font-size: 16px;
      padding: 6px 12px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    .info-panel {
      background: #fff;
      border: 1px solid #ddd;
      border-radius: 8px;
      padding: 16px;
      margin-top: 30px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
      max-width: 800px;
    }

    .info-panel h3 {
      margin-bottom: 12px;
      color: #333;
    }

    .info-row {
      margin-bottom: 12px;
      font-size: 16px;
    }

    .info-row ul {
      padding-left: 20px;
      margin: 6px 0;
    }

    .reminder {
      background: #f9f9f9;
      padding: 10px;
      border-left: 4px solid #007bff;
      border-radius: 4px;
      color: #444;
    }
  </style>
</head>

<body>
  <!-- LOGO -->
  <div style="text-align: center; margin-bottom: 20px;">
    <img src="/uploads/company-logo.png" alt="å…¬å¸LOGO" style="height: 80px;">
  </div>
  <!-- åŸæœ¬çš„æ¨™é¡Œ -->
  <h2>å°åŒ—å—å€å‹¤å‰ç…§ç‰‡ä¸Šå‚³ç³»çµ±</h2>

  <div class="info-panel">
    <h3>ä»Šæ—¥è³‡è¨Šçœ‹æ¿</h3>
    <div class="info-row">
      <strong>ğŸ“… ä»Šæ—¥æ—¥æœŸï¼š</strong>
      <span id="todayDate">è¼‰å…¥ä¸­...</span>
      <span id="weekday">ï¼ˆæ˜ŸæœŸè¼‰å…¥ä¸­ï¼‰</span>

    </div>
    <div class="info-row">
      <strong>ğŸŒ¤ å¤©æ°£é å ±ï¼š</strong>
      <ul id="weatherList">
        <li>å°åŒ—å¸‚ï¼šè¼‰å…¥ä¸­...</li>
        <li>æ–°åŒ—å¸‚ï¼šè¼‰å…¥ä¸­...</li>
        <li>æ¡ƒåœ’å¸‚ï¼šè¼‰å…¥ä¸­...</li>
        <li>æ–°ç«¹å¸‚ï¼šè¼‰å…¥ä¸­...</li>
        <li>è‹—æ —ç¸£ï¼šè¼‰å…¥ä¸­...</li>
      </ul>
    </div>
    <div class="info-row">
      <strong>ğŸ’¡ å€ç¶“ç†æé†’ï¼š</strong>
      <div class="reminder">
        ä¸€ã€æœ¬ç³»çµ±é è¨ˆä¸Šå‚³è‡³114.11.28(äº”)å¾Œå†å¦è¡Œå…¬å¸ƒã€‚<br>
        äºŒã€è«‹ç¢ºä¿ç…§ç‰‡æ¸…æ™°ã€å®Œæ•´ï¼Œç›¡é‡æ§åˆ¶æ¯å¤©ä¸Šå‚³4è‡³6å¼µ(åŒ…å«å‹¤å‰æŒ‡ç¤ºå–®)ã€‚<br>
        ä¸‰ã€è‹¥é‡å¤§æ¨“è¨­å‚™ç•°å¸¸ï¼Œè«‹ç«‹å³é€šå ±å€ç¾¤çµ„ä¸¦æ‹ç…§è¨˜éŒ„ã€‚
      </div>
    </div>
  </div>

  <h3>è«‹å…ˆé¸æ“‡æ‰€å±¬å¤§æ¨“åˆ¥</h3>
  <select name="building" id="building">
    <option value="" disabled selected hidden>è«‹é¸æ“‡</option>
    <option value="æ¾å±±é‡‘è">æ¾å±±é‡‘è</option>
    <option value="å‰ç»é‡‘è">å‰ç»é‡‘è</option>
    <option value="å…¨çƒæ°‘æ¬Š">å…¨çƒæ°‘æ¬Š</option>
    <option value="ç”¢ç‰©å¤§æ¨“">ç”¢ç‰©å¤§æ¨“</option>
    <option value="èŠ·è‹±å¤§æ¨“">èŠ·è‹±å¤§æ¨“</option>
    <option value="è¯èˆªå¤§æ¨“">è¯èˆªå¤§æ¨“</option>
    <option value="å—äº¬ç§‘æŠ€">å—äº¬ç§‘æŠ€</option>
    <option value="äº’åŠ©ç‡Ÿé€ ">äº’åŠ©ç‡Ÿé€ </option>
    <option value="æ‘©å¤©å¤§æ¨“">æ‘©å¤©å¤§æ¨“</option>
    <option value="æ–°èŠè¾²æœƒ">æ–°èŠè¾²æœƒ</option>
    <option value="å„’é´»ä¼æ¥­">å„’é´»ä¼æ¥­</option>
    <option value="æ–°æ¿å‚‘ä»•å ¡">æ–°æ¿å‚‘ä»•å ¡</option>
    <option value="æ–°æ¿é‡‘è">æ–°æ¿é‡‘è</option>
    <option value="æ¡ƒåœ’é‡‘è">æ¡ƒåœ’é‡‘è</option>
    <option value="æ–°ç«¹å¤§æ¨“">æ–°ç«¹å¤§æ¨“</option>
    <option value="ç«¹ç§‘å¤§æ¨“">ç«¹ç§‘å¤§æ¨“</option>
    <option value="é ­ä»½å¤§æ¨“">é ­ä»½å¤§æ¨“</option>
  </select>
  <br><br>

  <!-- å››çµ„ä¸Šå‚³æ¬„ä½ -->
  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview1')">
    <img id="preview1" class="preview" src="">
    <span class="note-label">å‚™è¨»ï¼šå‹¤å‰ç…§ç‰‡</span>
    <button onclick="uploadImage(this, 'preview1')">é»æ“Šä¸Šå‚³</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview2')">
    <img id="preview2" class="preview" src="">
    <span class="note-label">å‚™è¨»ï¼šå‹¤å‰ç…§ç‰‡</span>
    <button onclick="uploadImage(this, 'preview2')">é»æ“Šä¸Šå‚³</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview3')">
    <img id="preview3" class="preview" src="">
    <span class="note-label">å‚™è¨»ï¼šå‹¤å‰ç…§ç‰‡</span>
    <button onclick="uploadImage(this, 'preview3')">é»æ“Šä¸Šå‚³</button>
  </div>

  <div class="upload-row">
    <input type="file" accept="image/jpeg" onchange="previewImage(this, 'preview4')">
    <img id="preview4" class="preview" src="">
    <span class="note-label">å‚™è¨»ï¼šå‹¤å‰æŒ‡ç¤ºå–®</span>
    <button onclick="uploadImage(this, 'preview4')">é»æ“Šä¸Šå‚³</button>
  </div>

  <h3>å‹¤å‰ç…§ç‰‡ä¸Šå‚³é è¦½</h3>
  <label for="date">é¸æ“‡æ—¥æœŸï¼š</label>
  <input type="date" id="date" oninput="filterByDate()">

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const images = document.querySelectorAll(".preview-img");
      images.forEach(img => {
        img.addEventListener("click", () => {
          img.classList.toggle("zoom");
        });
      });
    });
    function filterByDate() {
      const date = document.getElementById('date').value;
      window.location.href = '/gallery?date=' + date;
    }
  </script>

  <h3>å‹¤å‰ç…§ç‰‡ä¸Šå‚³çµ±è¨ˆæŸ¥è©¢</h3>
  <label for="month">é¸æ“‡æœˆä»½ï¼š</label>
  <input type="month" id="month" onchange="filterByMonth()">

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('previewDate').value = today;
      loadGallery();
    });

    function uploadImage(button, previewId) {
      const row = button.parentElement;
      const fileInput = row.querySelector('input[type="file"]');
      const noteLabel = row.querySelector('.note-label');
      const building = document.getElementById('building').value;
      const file = fileInput.files[0];
      const note = noteLabel.textContent.replace('å‚™è¨»ï¼š', '').trim();

      if (!file || !building) {
        alert('è«‹é¸æ“‡æ‰€å±¬å¤§æ¨“åˆ¥');
        return;
      }

      const formData = new FormData();
      formData.append('image', file);
      formData.append('building', building);
      formData.append('note', note);

      fetch('/upload-image', {
        method: 'POST',
        body: formData
      })
        .then(res => res.json())
        .then(data => {
          alert(data.message || 'åœ–ç‰‡ä¸Šå‚³æˆåŠŸ');

          // âœ… æ›´æ–°åœ–ç‰‡é è¦½ç‚ºä¼ºæœå™¨ä¸Šçš„åœ–ç‰‡ï¼ˆå¯é¸ï¼‰
          const preview = document.getElementById(previewId);
          if (preview && data.filename) {
            preview.src = encodeURI('/uploads/' + data.filename);
            preview.style.display = 'inline-block'; // å¦‚æœä½ æƒ³é¡¯ç¤ºä¼ºæœå™¨åœ–ç‰‡
          }

          // âœ… è¨˜ä½æª”åï¼ˆå­˜åœ¨ row çš„ data-filename å±¬æ€§ï¼‰
          row.setAttribute('data-filename', data.filename);

          // âœ… æ¸…ç©ºæª”æ¡ˆæ¬„ä½
          fileInput.value = '';

          // âœ… æ¸…ç©ºé è¦½åœ–ç‰‡ï¼ˆè®“ä½¿ç”¨è€…çŸ¥é“å·²å®Œæˆï¼‰
          if (preview) {
            // è‹¥ä½ ä¸æƒ³é¡¯ç¤ºä¼ºæœå™¨åœ–ç‰‡ï¼Œè€Œæ˜¯ç›´æ¥æ¸…ç©ºé è¦½ï¼š
            preview.removeAttribute('src');
            preview.style.display = 'none';
          }
        })

    }

    // âœ… è·³è½‰çµ±è¨ˆæŸ¥è©¢
    function filterByMonth() {
      const month = document.getElementById('month').value;
      window.location.href = '/stats?month=' + month;
    }
  </script>

  <script>
    function previewImage(input, previewId) {
      const file = input.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (e) {
        const preview = document.getElementById(previewId);
        preview.src = e.target.result;
        preview.style.display = 'block'; // é¡¯ç¤ºåœ–ç‰‡ï¼ˆå¦‚æœä½ æœ‰ç”¨ CSS éš±è—ï¼‰
      };
      reader.readAsDataURL(file);
    }
  </script>

  <!-- å€ç¶“ç†æé†’å€å¡Š -->
  <script>
    // é¡¯ç¤ºä»Šæ—¥æ—¥æœŸï¼ˆåœ‹æ›†ï¼‰
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, '0');
    const dd = String(today.getDate()).padStart(2, '0');
    const weekdays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    document.getElementById('todayDate').textContent = `${yyyy}å¹´${mm}æœˆ${dd}æ—¥`;
    document.getElementById('weekday').textContent = `ï¼ˆæ˜ŸæœŸ${weekdays[today.getDay()]}ï¼‰`;

    // ç°¡æ˜“å¤©æ°£é å ±ï¼ˆä½¿ç”¨ Open-Meteo APIï¼‰
    const cities = [
      { name: 'å°åŒ—å¸‚', lat: 25.03, lon: 121.56 },
      { name: 'æ–°åŒ—å¸‚', lat: 25.01, lon: 121.46 },
      { name: 'æ¡ƒåœ’å¸‚', lat: 24.99, lon: 121.31 },
      { name: 'æ–°ç«¹å¸‚', lat: 24.81, lon: 120.97 },
      { name: 'è‹—æ —ç¸£', lat: 24.56, lon: 120.82 }
    ];

    async function loadWeather() {
      const list = document.getElementById('weatherList');
      list.innerHTML = '';
      for (const city of cities) {
        try {
          const resp = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${city.lat}&longitude=${city.lon}&current_weather=true&hourly=precipitation`);
          const data = await resp.json();
          const weather = data.current_weather;
          const rain = data.hourly?.precipitation?.[0] || 0;
          const rainText = rain > 0 ? `ğŸŒ§ å¯èƒ½é™é›¨ (${rain}mm)` : `â˜€ ç„¡é™é›¨`;
          const desc = `æ°£æº« ${weather.temperature}Â°Cï¼Œé¢¨é€Ÿ ${weather.windspeed} km/hï¼Œ${rainText}`;
          const li = document.createElement('li');
          li.textContent = `${city.name}ï¼š${desc}`;
          list.appendChild(li);
        } catch (err) {
          const li = document.createElement('li');
          li.textContent = `${city.name}ï¼šç„¡æ³•å–å¾—è³‡æ–™`;
          list.appendChild(li);
        }
      }
    }

    loadWeather();

    // ç´«å¤–ç·šæŒ‡æ•¸ï¼ˆé è¨­æˆ–ä¸²æ¥ APIï¼‰
    document.getElementById('uvi').textContent = 'ä¸­é‡ç´šï¼ˆé è¨­ï¼‰';
    // ç©ºæ°£å“è³ªï¼ˆé è¨­æˆ–ä¸²æ¥ APIï¼‰
    document.getElementById('aqi').textContent = 'è‰¯å¥½ï¼ˆé è¨­ï¼‰';

  </script>



</body>

</html>